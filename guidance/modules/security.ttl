@prefix : <./security#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix dc: <http://purl.org/dc/elements/1.1/> .
@prefix dct: <http://purl.org/dc/terms/> .
@prefix core: <../core#> .
@prefix model: <../model#> .
@prefix guidance: <../../guidance#> .

# Security Module Definition
:SecurityGuidanceModule rdf:type owl:Ontology ;
    rdfs:label "Security Guidance Module" ;
    rdfs:comment "Security patterns and best practices for guidance ontology" ;
    dc:title "Security Guidance Module" ;
    dc:version "1.0.0" ;
    owl:versionInfo "1.0.0" ;
    dct:created "2024-03-21"^^xsd:dateTime ;
    dct:modified "2024-03-21"^^xsd:dateTime ;
    owl:imports <core.ttl> ;
    owl:imports <model.ttl> ;
    owl:imports <validation.ttl> ;
    owl:imports <collaboration.ttl> .

# Security Pattern Classes
:SecurityPattern rdf:type owl:Class ;
    rdfs:label "SecurityPattern" ;
    rdfs:comment "A pattern for implementing security features and best practices" ;
    rdfs:subClassOf core:BestPractice ;
    owl:versionInfo "1.0.0" .

:CIAPattern rdf:type owl:Class ;
    rdfs:label "CIA Security Pattern" ;
    rdfs:comment """Base pattern ensuring all three pillars of security:
    - Confidentiality: Protect sensitive data from unauthorized access
    - Integrity: Ensure data remains accurate and unaltered
    - Availability: Guarantee authorized users can access data when needed""" ;
    rdfs:subClassOf :SecurityPattern ;
    owl:versionInfo "1.0.0" .

:AuthenticationPattern rdf:type owl:Class ;
    rdfs:label "AuthenticationPattern" ;
    rdfs:comment "A pattern for implementing authentication mechanisms" ;
    rdfs:subClassOf :SecurityPattern ;
    owl:versionInfo "1.0.0" .

:KeyManagementPattern rdf:type owl:Class ;
    rdfs:label "Key Management Pattern" ;
    rdfs:comment "A pattern for managing cryptographic keys" ;
    rdfs:subClassOf :SecurityPattern ;
    owl:versionInfo "1.0.0" .

:KeyDeletionPattern rdf:type owl:Class ;
    rdfs:label "Key Deletion Pattern" ;
    rdfs:comment "A pattern for safely handling deletion of keys and credentials" ;
    rdfs:subClassOf :SecurityPattern ;
    owl:versionInfo "1.0.0" .

:SLACompliancePattern rdf:type owl:Class ;
    rdfs:label "SLA Compliance Pattern" ;
    rdfs:comment """Pattern ensuring security measures meet operational SLAs:
    - Access time requirements
    - Availability percentages
    - Recovery time objectives
    - Security measure performance impact""" ;
    rdfs:subClassOf :CIAPattern ;
    owl:versionInfo "1.0.0" .

:EmergencyAccessPattern rdf:type owl:Class ;
    rdfs:label "Emergency Access Pattern" ;
    rdfs:comment """Pattern for ensuring access during incidents:
    - Must work when primary auth is down
    - Must work when network is degraded
    - Must work when key personnel are unavailable
    - Must work when documentation is inaccessible
    - Must not depend on external services""" ;
    rdfs:subClassOf :CIAPattern ;
    owl:versionInfo "1.0.0" .

:IncidentResponsePattern rdf:type owl:Class ;
    rdfs:label "Incident Response Pattern" ;
    rdfs:comment """Pattern for maintaining security during incidents:
    - Emergency access procedures
    - Offline authentication methods
    - Local credential caching
    - Break-glass procedures
    - Recovery from auth failures""" ;
    rdfs:subClassOf :SecurityPattern ;
    owl:versionInfo "1.0.0" .

# Security Properties
:implements rdf:type owl:ObjectProperty ;
    rdfs:label "Implements" ;
    rdfs:comment "Links pattern to implemented solution" ;
    rdfs:domain :SecurityPattern ;
    rdfs:range owl:Thing .

:requires rdf:type owl:ObjectProperty ;
    rdfs:label "Requires" ;
    rdfs:comment "Links pattern to required dependencies" ;
    rdfs:domain :SecurityPattern ;
    rdfs:range :SecurityPattern .

:recommends rdf:type owl:ObjectProperty ;
    rdfs:label "Recommends" ;
    rdfs:comment "Links pattern to recommended practices" ;
    rdfs:domain :SecurityPattern ;
    rdfs:range :SecurityPattern .

:hasSLA rdf:type owl:ObjectProperty ;
    rdfs:label "Has SLA" ;
    rdfs:comment "Links security pattern to its SLA requirements" ;
    rdfs:domain :SecurityPattern ;
    rdfs:range :SLARequirement .

:SLARequirement rdf:type owl:Class ;
    rdfs:label "SLA Requirement" ;
    rdfs:comment "Specific SLA requirements for security measures" .

:SLAViolation rdf:type owl:Class ;
    rdfs:label "SLA Violation" ;
    rdfs:comment "Represents a security incident where SLA requirements were not met" ;
    rdfs:subClassOf :SecurityPattern .

# Security Pattern Instances
:RSAKeyPairAuth rdf:type owl:NamedIndividual ;
    rdf:type :AuthenticationPattern ;
    rdfs:label "RSA Key Pair Authentication" ;
    rdfs:comment "Authentication using RSA key pairs" ;
    :requires :SecureKeyStorage ;
    :recommends :KeyRotation .

:SecureKeyStorage rdf:type owl:NamedIndividual ;
    rdf:type :KeyManagementPattern ;
    rdfs:label "Secure Key Storage" ;
    rdfs:comment "Pattern for securely storing cryptographic keys" ;
    :recommends :KeyEncryption .

:KeyRotation rdf:type owl:NamedIndividual ;
    rdf:type :KeyManagementPattern ;
    rdfs:label "Key Rotation" ;
    rdfs:comment "Pattern for regularly rotating cryptographic keys" ;
    :requires :SecureKeyStorage .

:KeyEncryption rdf:type owl:NamedIndividual ;
    rdf:type :KeyManagementPattern ;
    rdfs:label "Key Encryption" ;
    rdfs:comment "Pattern for encrypting stored keys" .

:CIATriadEnforcement rdf:type owl:NamedIndividual ;
    rdf:type :CIAPattern ;
    rdfs:label "CIA Triad Enforcement" ;
    rdfs:comment """Fundamental security requirements:
    1. Confidentiality: Protect secrets and keys from unauthorized access
    2. Integrity: Ensure keys and configs remain accurate and unmodified
    3. Availability: CRITICAL - Never compromise access to necessary keys and configs
       - Maintain working copies of all essential credentials
       - Verify backup accessibility before any changes
       - Consider operational impact before security changes
       - Security must not break functionality
       - TRACK AND REPORT SLA VIOLATIONS AS SECURITY INCIDENTS
       - Monitor access time compliance
       - Regular availability testing required
       - Emergency access is a SECURITY requirement
       - Forcing shadow systems is a security FAILURE
       - Must provide and secure offline auth methods
       - Must support incident response scenarios
       - Must work when external services are down""" ;
    :requires :SecureKeyStorage ;
    :requires :OperationalSLAEnforcement ;
    :requires :EmergencyAccess ;
    :recommends :KeyBackupVerification .

:SecureKeyDeletion rdf:type owl:NamedIndividual ;
    rdf:type :KeyDeletionPattern ;
    rdfs:label "Secure Key Deletion" ;
    rdfs:comment """Critical rules for key deletion:
    1. NEVER delete any .env files without verified backup
    2. ALWAYS confirm backup location before deletion
    3. ALWAYS get explicit user confirmation before deletion
    4. Treat .gitignore'd files with extra caution - they likely contain untracked sensitive data
    5. Maintain backup verification logs
    6. AVAILABILITY FIRST - Never delete unique copies of credentials
    7. Security procedures must not impair authorized access""" ;
    :requires :SecureKeyStorage ;
    :requires :CIATriadEnforcement ;
    :recommends :KeyBackupVerification .

:KeyBackupVerification rdf:type owl:NamedIndividual ;
    rdf:type :KeyManagementPattern ;
    rdfs:label "Key Backup Verification" ;
    rdfs:comment "Pattern for verifying key backups before any deletion operations" ;
    :requires :SecureKeyStorage .

:OperationalSLAEnforcement rdf:type owl:NamedIndividual ;
    rdf:type :SLACompliancePattern ;
    rdfs:label "Operational SLA Enforcement" ;
    rdfs:comment """Critical operational security requirements:
    1. Access time SLAs are SECURITY requirements
    2. ANY failure to meet access time SLAs is a SECURITY INCIDENT
    3. Security measures MUST be tested against SLA requirements
    4. SLA violations must be tracked and remediated as security issues
    5. Security changes require SLA impact analysis
    6. Performance degradation beyond SLA is a security failure
    7. Regular SLA compliance auditing required""" ;
    :requires :CIATriadEnforcement ;
    :requires :SecureKeyStorage .

:EmergencyAccess rdf:type owl:NamedIndividual ;
    rdf:type :EmergencyAccessPattern ;
    rdfs:label "Emergency Access Controls" ;
    rdfs:comment """Critical emergency access requirements:
    1. MUST work offline/disconnected
    2. MUST have multiple independent auth paths
    3. MUST NOT depend on unavailable personnel
    4. MUST have documented recovery procedures
    5. MUST be tested regularly in realistic conditions
    6. MUST be accessible during network outages
    7. MUST support local credential caching
    8. MUST have multiple backup authentication methods
    9. MUST NOT force choices between uptime and security
    10. MUST acknowledge and secure 'unofficial' backup methods""" ;
    :requires :CIATriadEnforcement ;
    :requires :OperationalSLAEnforcement .

:IncidentResponse rdf:type owl:NamedIndividual ;
    rdf:type :IncidentResponsePattern ;
    rdfs:label "Incident Response Procedures" ;
    rdfs:comment """Incident response requirements:
    1. Emergency auth MUST work when everything else is down
    2. Break-glass procedures MUST be fully local
    3. Recovery procedures MUST be cached offline
    4. Backup credentials MUST be securely accessible
    5. Auth failures MUST NOT escalate incidents
    6. MUST have degraded operation modes
    7. MUST support disconnected operation
    8. MUST track and audit emergency access
    9. MUST provide secure ways to cache credentials
    10. MUST NOT force admins to create shadow systems""" ;
    :requires :EmergencyAccess ;
    :requires :SecureKeyStorage .

# Security Best Practices
:SecurityBestPractices rdf:type owl:NamedIndividual ;
    rdf:type core:BestPractice ;
    rdfs:label "Security Best Practices" ;
    rdfs:comment """Collection of security best practices:
    1. Store private keys with 600 permissions
    2. Never commit secrets to VCS
    3. Use PKCS#8 format for private keys
    4. Use environment variables for sensitive data
    5. Implement regular key rotation
    6. NEVER delete .env or configuration files without verified backup
    7. ALWAYS get explicit confirmation before key deletion
    8. AVAILABILITY IS CRITICAL - Security must not break functionality
    9. Maintain working access to all essential credentials
    10. Balance security measures against operational needs
    11. TRACK ALL SLA VIOLATIONS AS SECURITY INCIDENTS
    12. Test security measures against SLA requirements
    13. Regular SLA compliance auditing required
    14. Emergency access MUST work offline
    15. Provide secure ways to cache credentials
    16. Test auth systems during simulated outages
    17. Never force shadow security systems
    18. Plan for degraded/disconnected operation
    19. Maintain local authentication capability""" .

# Legacy Support
:hasLegacySecurityConcept rdf:type owl:ObjectProperty ;
    rdfs:label "Has Legacy Security Concept" ;
    rdfs:comment "Links modular security concept to legacy guidance" ;
    rdfs:domain :SecurityPattern ;
    rdfs:range guidance:LLMGuidanceOntology . 