version: '3.8'

services:
  graphdb:
    image: ontotext/graphdb:10.4.0
    container_name: graphdb
    ports:
      - "7200:7200"
    volumes:
      - ./data/graphdb:/opt/graphdb/home
    environment:
      - GDB_HEAP_SIZE=1g
      - GDB_JAVA_OPTS=-Dgraphdb.workbench.maxUploadSize=100000000 -Xms512m -Xmx512m
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7200/rest/repositories"]
      interval: 30s
      timeout: 10s
      retries: 3
    shm_size: '1gb'
    ulimits:
      memlock:
        soft: -1
        hard: -1
      nofile:
        soft: 65536
        hard: 65536
  pdf-processor:
    build: .
    volumes:
      - .:/app
      - ./data:/app/data
    environment:
      - PYTHONPATH=/app
      - CONDA_DEFAULT_ENV=ontology-framework
    command: conda run -n ontology-framework python -m tests.test_pdf_processor
    depends_on:
      graphdb:
        condition: service_healthy

volumes:
  graphdb-data:
    driver: local
  graphdb-import:
    driver: local 